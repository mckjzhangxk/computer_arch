# MIPS 寄存器

| 寄存器名称 | 寄存器编号 | 用途                  | 调用约定            |
|------------|------------|-----------------------|---------------------|
| $zero      | $0         | 常数 0                |                     |
| $at        | $1         | 保留给汇编器使用      |                     |
| $v0-$v1    | $2-$3      | 函数返回值            | 返回值              |
| $a0-$a3    | $4-$7      | 函数参数              | 参数                |
| $t0-$t7    | $8-$15     | 临时寄存器            | 调用者保存          |
| $s0-$s7    | $16-$23    | 保存寄存器            | 被调用者保存        |
| $t8-$t9    | $24-$25    | 临时寄存器            | 调用者保存          |
| $k0-$k1    | $26-$27    | 保留给操作系统使用    |                     |
| $gp        | $28        | 全局指针              |                     |
| $sp        | $29        | 堆栈指针              |                     |
| $fp        | $30        | 帧指针                |                     |
| $ra        | $31        | 返回地址              | 返回地址            |


## MIPS 指令格式

MIPS 指令集架构有三种主要的指令格式：R 型、I 型和 J 型。

### R 型指令格式

R 型指令用于寄存器之间的操作。其格式如下：

```
| opcode (6) | rs (5) | rt (5) | rd (5) | shamt (5) | funct (6) |
```

- `opcode`: 操作码，指定操作类型。
- `rs`: 第一个源寄存器。
- `rt`: 第二个源寄存器。
- `rd`: 目标寄存器。
- `shamt`: 移位量，用于移位指令。
- `funct`: 功能码，进一步指定操作类型。

### I 型指令格式

I 型指令用于立即数操作、加载和存储指令。其格式如下：

```
| opcode (6) | rs (5) | rt (5) | immediate (16) |
```

- `opcode`: 操作码，指定操作类型。
- `rs`: 源寄存器。
- `rt`: 目标寄存器。
- `immediate`: 立即数或偏移量。
### 常见的 I 型指令

以下是一些常见的 I 型指令及其操作码：

| 指令 | 操作码 (opcode) | 功能                   |
|------|-----------------|------------------------|
| `addi` | 0x08           | 加立即数               |
| `andi` | 0x0C           | 按位与立即数           |
| `ori`  | 0x0D           | 按位或立即数           |
| `xori` | 0x0E           | 按位异或立即数         |
| `lui`  | 0x0F           | 装载上半字             |
| `lw`   | 0x23           | 加载字                 |
| `sw`   | 0x2B           | 存储字                 |
| `beq`  | 0x04           | 相等时分支             |
| `bne`  | 0x05           | 不相等时分支           |
### J 型指令格式

J 型指令用于跳转指令。其格式如下：

```
| opcode (6) | address (26) |
```

- `opcode`: 操作码，指定操作类型。
- `address`: 目标地址。
## MIPS 执行流水线

MIPS 处理器使用流水线技术来提高指令执行的效率。流水线将指令的执行过程分为多个阶段，每个阶段由不同的硬件单元处理。MIPS 的经典五级流水线包括以下阶段：

1. **取指令（IF）**: 从内存中取出指令。
2. **指令译码（ID）**: 解析指令并读取寄存器中的操作数。
3. **执行（EX）**: 在 ALU 中执行操作。
4. **访存（MEM）**: 访问数据存储器（对于加载和存储指令）。
5. **写回（WB）**: 将结果写回寄存器。

### 流水线的优点

- **提高吞吐量**: 流水线允许多个指令同时在不同阶段执行，从而提高了指令吞吐量。
- **减少指令执行时间**: 每条指令的执行时间减少，因为每个阶段的操作可以并行进行。

### 流水线的挑战

- **数据冒险**: 当指令依赖于前一条指令的结果时，可能会发生数据冒险。
- **控制冒险**: 分支指令可能会改变程序的执行流，导致控制冒险。
- **结构冒险**: 当多个指令需要同时访问同一硬件资源时，可能会发生结构冒险。

### 解决流水线冒险的方法

- **数据转发**: 通过将结果直接从一个流水线阶段传递到另一个阶段，减少数据冒险的影响。
- **分支预测**: 通过预测分支的结果，减少控制冒险的影响。
- **流水线暂停**: 在发生冒险时暂停流水线，直到冒险被解决。

通过有效地管理这些挑战，MIPS 流水线能够显著提高处理器的性能。